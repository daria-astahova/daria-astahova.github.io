<!doctype html>
<html>

<head>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>GIMM 285 Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
</head>

<body>

    <div class="row">

        <h1 class="col-12 hiking-header">
            Hiking Data
        </h1>

    </div>
    <div id='invalid-form' class='alert alert-danger'>&nbsp;</div>
    <hr />

    <div class='row mb-3'>
        <div class='col-md-4'>
            <b>Trail Name</b>
        </div>
        <div class='col-md-8'>
            <input type="text" id="trailName" name="trailName" placeholder="Enter trail name">
        </div>
    </div>

    <div class='row mb-3'>
        <div id='trailName-error' class='col-12 text-danger'>&nbsp;</div>
    </div>

    <div class='row mb-3'>
        <div class='col-md-4'>
            <b>Location</b>
        </div>
        <div class='col-md-8'>
            <input type="text" id="location" name="location" placeholder="Enter location">
        </div>
    </div>
    <div class='row mb-3'>
        <div id='location-error' class='col-12 text-danger'>&nbsp;</div>
    </div>
    <div class='row mb-3'>
        <div class='col-md-4'>
            <b>Date</b>
        </div>
        <div class='col-md-8'>
            <input type="date" id="date" name="date" multiple>
        </div>
    </div>
    <div class='row mb-3'>
        <div id='date-error' class='col-12 text-danger'>&nbsp;</div>
    </div>
    <div class='row mb-3'>
        <div class='col-md-4'>
            <b>Distance</b>
        </div>
        <div class='col-md-8'>
            <input type="text" id="distance" name="distance" placeholder="Enter distance in miles">
        </div>
    </div>
    <div class='row mb-3'>
        <div id='distance-error' class='col-12 text-danger'>&nbsp;</div>
    </div>
    <div class='row mb-3'>
        <div class='col-md-4'>
            <b>Duration (hours)</b>
        </div>
        <div class='col-md-8'>
            <input type="text" id="duration" name="duration" placeholder="Enter duration in hours">
            </div>
    </div>
    <div class='row mb-3'>
        <div id='duration-error' class='col-12 text-danger'>&nbsp;</div>
    </div>
    <div class='row mb-3'>
        <div class='col-md-4'>
            <b>Difficulty</b>
        </div>
        <div class='col-md-8'>
            <select id="difficulty" name="difficulty">
                <option value="%"> Select</option>
                <option value="Easy"> Easy</option>
                <option value="Moderate"> Moderate</option>
                <option value="Strenuous"> Strenuous</option>
            </select>
       </div>
    </div>
    <div class='row mb-3'>
        <div id='difficulty-error' class='col-12 text-danger'>&nbsp;</div>
    </div>
    <div class='row'>
        <div class='col-12'>
            <label>Trail Route</label>
            <select id="route" name="route">
                <option value="%"> Select</option>
                <option value="Out"> Out and Back</option>
                <option value="Loop"> Loop</option>
                <option value="Point"> Point to Point</option>
            </select>
      </div>
    </div>
    <div class='row mb-3'>
        <div id='route-error' class='col-12 text-danger'>&nbsp;</div>
    </div>
    <div class='row'>
        <div class='col-12'>
            <button id='submit'>Submit</button>
        </div>
    </div>

    <hr />
    <script>
        // Hide banner at start of script
        const errorBanner = document.getElementById('invalid-form');
        errorBanner.hidden = true;

        document.getElementById('submit').addEventListener('click', () => {
            const formData = new FormData();
            const fileField = document.querySelector('input[type="file"]');

            formData.append('trailName', document.getElementById('trailName').value);
            formData.append('location', document.getElementById('location').value);
            formData.append('date', document.getElementById('date').value);
            formData.append('distance', document.getElementById('distance').value);
            formData.append('duration', document.getElementById('duration').value);
            formData.append('difficulty', document.getElementById('difficulty').value);
            formData.append('route', document.getElementById('route').value);
             // Settings for FETCH API request
            let fetchSettings = {
                method: 'POST',
                body: formData
            };

            // Send FETCH API request
            fetch("http://localhost/", fetchSettings)
                .then((response) => {
                    return new Promise((resolve) => response.json()
                        .then((json) => resolve({
                            status: response.status,
                            json,
                        })
                    ));
                })
                // Logic to display errors on form 
                .then(({ status, json }) => {
                    errorBanner.hidden = true;
                    if (status === 400) {
                        errorBanner.innerText = 'Form has errors. Please correct them and resubmit.';
                        errorBanner.hidden = false;
                        for (error of json.errors) {
                            const errorId = error.path + '-error';
                            document.getElementById(errorId).innerHTML = error.msg
                        }
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            return;
        })
    </script>
</body>

</html>
